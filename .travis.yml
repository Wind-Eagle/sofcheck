language: cpp

matrix:
  include:
    - dist: bionic
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - g++-8
            - libgtest-dev
            - libbenchmark-dev
            - libboost-stacktrace-dev
            - cmake
      env:
         - MATRIX_EVAL="CC=gcc-8 && CXX=g++-8" BMI2_CMD="-DUSE_BMI2=OFF"
         - MATRIX_EVAL="CC=gcc-8 && CXX=g++-8" BMI2_CMD="-DUSE_BMI2=ON"

    - dist: bionic
      addons:
        apt:
          packages:
            - libgtest-dev
            - libbenchmark-dev
            - libboost-stacktrace-dev
            - cmake
      compiler: clang
      env:
        - BMI2_CMD="-DUSE_BMI2=OFF"
        - BMI2_CMD="-DUSE_BMI2=ON"

before_install:
  - eval "${MATRIX_EVAL}"

before_script:
  - mkdir build
  - cd build

script:
  - cmake -DCMAKE_BUILD_TYPE=Release ${BMI2_CMD} -DUSE_NO_EXCEPTIONS=ON ..
  - make -j2
  - ctest
